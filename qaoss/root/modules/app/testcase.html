<script type="text/javascript" src="/res/js/platf.js"></script>
<script type="text/javascript" src="/pipes/module/js/queryall2"></script>

<div id="div_test_case">
    <div class="page-title">
        <h5>质量中心 -> 应用测试 -> 用例管理 【温馨提示】命名规则：test_平台_模块_用例名称，如：stock_person_login 表示有鱼股票-个人-登录用例</h5>
        <a id="button-intervaljob-create" href="javascript:void(0);"><i class="fa fa-plus"></i>新增</a>
        <a id="button-intervaljob-update" href="javascript:void(0);"><i class="fa fa-pencil-square-o"></i>修改</a>
        <a id="view_test_step" href="javascript:void(0);"><i class="fa fa-pencil-square-o"></i>查看用例详情</a>
    </div>
    <div>
        <div class="page-title">
            <form class="filter-search" style="width: 650px;">
                <span>应用</span>
                <select class="app" id="app" name="app">
                    <option value="">全选</option>
                </select>
                &nbsp;
                <span>模块</span>
                <select class="module" id="module" name="module" style="width: 100px;">
                    <option value="">全选</option>
                </select>
                &nbsp;
                <input id="filter_intervalname" type="text" placeholder="请输入需要查询的英文名" style="width: 350px;">
                <i id="filter-intervaljob-qrybtn" class="fa fa-search"></i>
            </form>
        </div>
        <div class="table-responsive">
            <table id="intervaljobtable" class="table table-hover table-striped" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th></th>
                        <th hidden>ID</th>
                        <th hidden>moduleID</th>
                        <th>编号</th>
                        <th>英文名</th>
                        <th>平台</th>
                        <th>模块</th>
                        <th>用例名称</th>
                        <th>步骤数量(android/ios)</th>
                        <th>创建时间</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <div id="dialog-alerttype-update" class="modal fade" tabindex="-1" data-width="550" data-backdrop="static" data-keyboard="false" style="display: none;"> 
        <div class="modal-header"> 
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button> 
            <h4 id="dtitle-alerttype-update" class="modal-title">修改</h4> 
        </div>
        <div class="modal-body"> 
            <form id="form-alerttype-update" class="m-t form-horizontal"> 
                <input class="select_id" name="id" type="hidden">
                <div class="form-group">
                    <label class="col-lg-2 control-label">平台</label>
                    <div class="col-lg-10">
                        <select name="platform_id" id="platform_id">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">模块</label>
                    <div class="col-lg-10">
                        <select name="module_id" id="module_id">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">英文名</label>
                    <div class="col-lg-10"><input name="ename" class="form-control" required><div class="help-block with-errors"></div></div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">描述</label>
                    <div class="col-lg-10"><input name="description" class="form-control" required><div class="help-block with-errors"></div></div>
                </div>
                <button id="form-alerttype-updatebtn" type="button" class="btn btn-theme btn-lg btn-block ">提 交</button><br>
            </form> 
        </div> 
    </div>
</div>


<div id="div_test_step" style="display:none">
    <div class="page-title">
        <h5>质量中心 -> 应用测试 -> 用例管理 -> 测试步骤</h5>
        <a id="back_to_test_case" href="javascript:void(0);"><i class="fa fa-backward"></i>返回</a>
        <a id="add_step" href="javascript:void(0);"><i class="fa fa-plus-square"></i>插入步骤</a>
        <a id="update_step" href="javascript:void(0);"><i class="fa fa-hand-peace-o"></i>更新步骤</a>
        <a id="delete_step" href="javascript:void(0);"><i class="fa fa-times"></i>删除步骤</a>
        <a id="copy_test_case" href="javascript:void(0);"><i class="fa fa-pencil-square-o"></i>复制其他用例到该用例</a>
        <form class="filter-search" style="width: 150px;">
            <select id="select_view_app">
                <option value="all">全部</option>
                <option value="android">Android</option>
                <option value="ios">iOS</option>
            </select>
            <i id="view_android_or_ios" class="fa fa-search"></i>
        </form>
    </div>
    <div style="float:left;width: 48%;" id="div_android">
        <div class="page-title">
            <h5>以下是Android设备执行步骤</h5>
        </div>
        <div class="table-responsive">
            <table id="intervaljobtable_android" class="table table-hover table-striped" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th></th>
                        <th hidden>ID</th>
                        <th hidden>moduleID</th>
                        <th>步骤</th>
                        <th>名称</th>
                        <th>参数1</th>
                        <th>参数2</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <div style="float:right;width: 48%;" id="div_ios">
        <div class="page-title">
            <h5>以下是iOS设备执行步骤</h5>
        </div>
        <div class="table-responsive">
            <table id="intervaljobtable_ios" class="table table-hover table-striped" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th></th>
                        <th hidden>ID</th>
                        <th hidden>moduleID</th>
                        <th>步骤</th>
                        <th>名称</th>
                        <th>参数1</th>
                        <th>参数2</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <div id="dialog-test-step" class="modal fade" tabindex="-1" data-width="550" data-backdrop="static" data-keyboard="false" style="display: none;"> 
        <div class="modal-header"> 
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button> 
            <h4 id="dtitle-test-step" class="modal-title">修改</h4> 
        </div>
        <div class="modal-body"> 
            <form id="form-test-step" class="m-t form-horizontal"> 
                <input class="select_step_id" name="id" type="hidden">
                <div class="form-group">
                    <label class="col-lg-2 control-label">名称</label>
                    <div class="col-lg-4">
                        <select name="step_method" id="step_method"></select>
                    </div>
                    <label class="col-lg-2 control-label">平台</label>
                    <div class="col-lg-4">
                        <select name="step_type" id="step_type">
                            <option value="android">android</option>
                            <option value="ios">ios</option>
                        </select>
                    </div>
                </div>
                <div id="explain" class="col-lg-12"></div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">参数1</label>
                    <div class="col-lg-10"><input name="parameter_1" class="form-control" required><div class="help-block with-errors"></div></div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">参数2</label>
                    <div class="col-lg-10"><input name="parameter_2" class="form-control" required><div class="help-block with-errors"></div></div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">执行顺序</label>
                    <div class="col-lg-10"><input name="step_run_id" class="form-control" required><div class="help-block with-errors"></div></div>
                </div>
                <button id="form-test-commit" type="button" class="btn btn-theme btn-lg btn-block ">提 交</button><br>
            </form> 
        </div> 
    </div>
    <div id="copy_test_case_dialog" class="modal fade" tabindex="-1" data-width="550" data-backdrop="static" data-keyboard="false" style="display: none;"> 
        <div class="modal-header"> 
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button> 
        </div>
        <div class="modal-body"> 
            <form id="form-copy_test_case_dialog" class="m-t form-horizontal"> 
                <div class="form-group">
                    <label class="col-lg-2 control-label">测试平台</label>
                    <div class="col-lg-10">
                        <select name="copy_platform_id" id="copy_platform_id">
                            <option value="android">android</option>
                            <option value="ios">ios</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">选择应用</label>
                    <div class="col-lg-4">
                        <select name="app_select_id" id="app_select_id">
                            <option value="">全选</option>
                        </select>
                    </div>
                    <label class="col-lg-2 control-label">选择模块</label>
                    <div class="col-lg-4">
                        <select name="module_select_id" id="module_select_id">
                            <option value="">全选</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-lg-2 control-label">现有用例</label>
                    <div class="col-lg-10">
                        <select name="test_case_now" id="test_case_now"></select>
                    </div>
                </div>
                <button id="form-commit_copy" type="button" class="btn btn-theme btn-lg btn-block ">提 交</button><br>
            </form> 
        </div> 
    </div>
</div>



<script>
    $(function () {
        var intervaljobtable = $("#intervaljobtable");
        var intervaljobtable_android = $("#intervaljobtable_android");
        var intervaljobtable_ios = $("#intervaljobtable_ios");
        var test_case_id_select = "";
        $("#app").empty();
        $("#module").empty();
        $("#app").append("<option value=\'\'>全选</option>");
        $("#module").append("<option value=\'\'>全选</option>");
        
        $.ajax ({
            url: '/pipes/app/application/queryall',
            async: false,
            cache: false,
            method: 'post',
            dataType: 'json',
            error: function () {
                alert('请求失败');
            },
            success: function (data) {
                var list = data.rows;
                for(var i=0;i<list.length;i++){
                    $("#app").append("<option value=\'" + list[i].id + "\'>" + list[i].name + "</option>");
                }
            }
        });
        
        //加载所有测试用例
        intervaljobtable.dataTable({
            paging: true,
            info: true,
            processing: true,
            pageLength: 20,
            destroy: true,
            ajax: ({
                url: '/pipes/app/testcase/queryall',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                data: function (f) {
                    f.bean = JSON.stringify({
                        platform_id: $("#app").val().trim(),
                        module_id: $("#module").val().trim(),
                        ename: $("#filter_intervalname").val().trim()
                    });
                },
                dataSrc: 'rows'
            }),
            columnDefs: [
                {
                    className: 'select-checkbox',
                    targets: 0
                }
            ],
            "columns": [
                {data: ""},
                {data: "id"},
                {data: "ename"},
                {data: "platform_name"},
                {data: "module_name"},
                {data: "description"},
                {data: "test_step_num"},
                {data: "ctime",
                        render: function (data, type, full, meta) {
                            return new Date(data);
                        }}
            ]
        });
        
        // 主页选择应用
        $('#app').bind("click", function(){
            var select = $("#app").val();
            $("#module").empty();
            $("#module").append("<option value=\'\'>全选</option>");
            
            $.ajax ({
                url: '/pipes/app/module/queryall',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    if(select == ""){
                        $("#module").append("<option value=\'\'>全选</option>");
                    }else{
                        for(var i=0;i<list.length;i++){
                            if(list[i].platform_id == select){
                                $("#module").append("<option value=\'" + list[i].id + "\'>" + list[i].name + "</option>");
                            }
                        }
                    }
                }
            });
        });
        
        // 弹出框选择应用
        $('#platform_id').bind("click", function(){
            var select = $("#platform_id").val();
            $("#module_id").empty();
            
            $.ajax ({
                url: '/pipes/app/module/queryall',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        if(list[i].platform_id == select){
                            $("#module_id").append("<option value=\'" + list[i].id + "\'>" + list[i].name + "</option>");
                        }
                    }
                }
            });
        });
        
        // 搜索 按钮 点击 事件 处理
        $('#filter-intervaljob-qrybtn').bind("click", function () {
            intervaljobtable.api(true).draw();
        });
        
        // 选择查看用例
        $("#view_android_or_ios").bind("click", function(){
            var select = $("#select_view_app").val();
            if(select === "all"){
                $("#div_ios").show();
                $("#div_ios").width("48%");
                $("#div_android").show();
                $("#div_android").width("48%");
            }
            if(select === "android"){
                $("#div_ios").hide();
                $("#div_ios").width("48%");
                $("#div_android").show();
                $("#div_android").width("100%");
            }
            if(select === "ios"){
                $("#div_android").hide();
                $("#div_android").width("48%");
                $("#div_ios").show();
                $("#div_ios").width("100%");
            }
        });
        
        //新增 测试用例
        $('#button-intervaljob-create').bind("click", function () {
            $(".select_id").val("");
            $("#platform_id").empty();
            $("#module_id").empty();
            $("#platform_id").append("<option value=\'\'>请选择</option>");
            $("#module_id").append("<option value=\'\'>请选择</option>");
            
            $.ajax ({
                url: '/pipes/app/application/queryall',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        $("#platform_id").append("<option value=\'" + list[i].id + "\'>" + list[i].name + "</option>");
                    }
                }
            });
            
            $('#dtitle-alerttype-update').html("新增");
            $("#form-alerttype-update").form('reset');
            $('#dialog-alerttype-update').modal('show');
        });
        
        //初始化 修改 测试用例
        $('#button-intervaljob-update').bind("click", function () {
            var data = intervaljobtable.api(true).row({selected: true}).data();
            
            if (!data) {
                toastr.options.positionClass = 'toast-top-center';
                toastr.options.timeOut = 2000;
                toastr.warning("请先选择记录");
                return;
            }
            $("#platform_id").empty();
            $("#module_id").empty();
            
            $.ajax ({
                url: '/pipes/app/application/queryall',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        $("#platform_id").append("<option value=\'" + list[i].id + "\'>" + list[i].name + "</option>");
                    }
                }
            });
            
            $.ajax ({
                url: '/pipes/app/module/queryall',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        $("#module_id").append("<option value=\'" + list[i].id + "\'>" + list[i].name + "</option>");
                    }
                }
            });
            $('#dtitle-alerttype-update').html("修改");
            $("#form-alerttype-update").form('reset');
            $("#form-alerttype-update").form('load', data);
            $('#dialog-alerttype-update').modal('show');
        });

        //新增&修改  测试用例        
        $('#form-alerttype-updatebtn').bind("click", function (e) {
            var form = $("#form-alerttype-update");
            var json = form.serializeJson();
            
            if (json.name === "") {
                toastr.options.positionClass = 'toast-top-center';
                toastr.options.timeOut = 2000;
                toastr.warning("温馨提示：请填写完整 ^-^");
                return;
            }

            $.ajax({
                cache: false,
                dataType: "json",
                type: "POST",
                url: json.id ? '/pipes/app/testcase/update' : '/pipes/app/testcase/create',
                data: {
                    "bean": $.objectToString(json)
                },
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    if (data.retcode === 0) {
                        $("#dialog-alerttype-update").modal('hide');
                        intervaljobtable.api(true).draw(false);
                    } else {
                        toastr.options.positionClass = 'toast-top-center';
                        toastr.options.timeOut = 2000;
                        toastr.warning(data.retinfo);
                    }
                }
            });
        });
        
        // 点击查看测试用例详情
        $("#view_test_step").bind("click", function(){
            var data = intervaljobtable.api(true).row({selected: true}).data();
            
            test_case_id_select = data["id"];
            
            if (!data) {
                toastr.options.positionClass = 'toast-top-center';
                toastr.options.timeOut = 2000;
                toastr.warning("请先选择记录");
                return;
            }
            
            $("#div_test_case").hide();
            $("#div_test_step").show();
            
            var select_id = data["id"];
            
            //加载 intervaljobtable_android
            intervaljobtable_android.dataTable({
                paging: true,
                info: true,
                processing: true,
                pageLength: 20,
                destroy: true,
                ajax: ({
                    url: '/pipes/app/casestep/queryall',
                    async: false,
                    cache: false,
                    method: 'post',
                    dataType: 'json',
                    data: function (f) {
                        f.bean = JSON.stringify({
                            case_id: select_id,
                            step_type: "android"
                        });
                    },
                    dataSrc: 'rows'
                }),
                columnDefs: [
                    {
                        className: 'select-checkbox',
                        targets: 0
                    }
                ],
                "columns": [
                    {data: ""},
                    {data: "step_run_id"},
                    {data: "step_method"},
                    {data: "parameter_1"},
                    {data: "parameter_2"}
                ]
            });
            
            //加载 intervaljobtable_ios
            intervaljobtable_ios.dataTable({
                paging: true,
                info: true,
                processing: true,
                pageLength: 20,
                destroy: true,
                ajax: ({
                    url: '/pipes/app/casestep/queryall',
                    async: false,
                    cache: false,
                    method: 'post',
                    dataType: 'json',
                    data: function (f) {
                        f.bean = JSON.stringify({
                            case_id: select_id,
                            step_type: "ios"
                        });
                    },
                    dataSrc: 'rows'
                }),
                columnDefs: [
                    {
                        className: 'select-checkbox',
                        targets: 0
                    }
                ],
                "columns": [
                    {data: ""},
                    {data: "step_run_id"},
                    {data: "step_method"},
                    {data: "parameter_1"},
                    {data: "parameter_2"}
                ]
            });
        });
        
        // 点击返回按钮， 从测试步骤返回到测试用例
        $("#back_to_test_case").bind("click", function(){
            $("#div_test_step").hide();
            $("#div_test_case").show();
        });
        
        // 删除测试步骤
        $("#delete_step").bind("click", function(){
            var data_android = intervaljobtable_android.api(true).row({selected: true}).data();
            var data_ios = intervaljobtable_ios.api(true).row({selected: true}).data();
 
            if (!data_android && !data_ios) {
                toastr.options.positionClass = 'toast-top-center';
                toastr.options.timeOut = 2000;
                toastr.warning("请先选择记录");
                return;
            }
            
            if(!data_android){
                $.ajax({
                    cache: false,
                    dataType: "json",
                    type: "POST",
                    url: "/pipes/app/casestep/delete",
                    data: {
                        "bean": $.objectToString(data_ios)
                    },
                    error: function () {
                        alert('请求失败');
                    },
                    success: function (data) {
                        if (data.retcode === 0) {
                            intervaljobtable_ios.api(true).draw(false);
                        } else {
                            toastr.options.positionClass = 'toast-top-center';
                            toastr.options.timeOut = 2000;
                            toastr.warning(data.retinfo);
                        }
                    }
                }); 
            }
            
            if(!data_ios){
                $.ajax({
                    cache: false,
                    dataType: "json",
                    type: "POST",
                    url: "/pipes/app/casestep/delete",
                    data: {
                        "bean": $.objectToString(data_android)
                    },
                    error: function () {
                        alert('请求失败');
                    },
                    success: function (data) {
                        if (data.retcode === 0) {
                            intervaljobtable_android.api(true).draw(false);
                        } else {
                            toastr.options.positionClass = 'toast-top-center';
                            toastr.options.timeOut = 2000;
                            toastr.warning(data.retinfo);
                        }
                    }
                });  
            }
            
        });
        
        // 点击新增测试步骤
        $("#add_step").bind("click", function(){
            $(".select_step_id").val("");
            $("#step_method").empty();
            $("#step_method").append("<option value=\'\'>请选择</option>");
            $.ajax ({
                url: '/pipes/app/testMethod/queryList',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        $("#step_method").append("<option value=\'" + list[i].name + "\'>" + list[i].name + "</option>");
                    }
                }
            });
            
            $('#dtitle-test-step').html("新增");
            $("#form-test-step").form('reset');
            $('#dialog-test-step').modal('show');
        });
        
        // 测试方法 显示提示语
        $("#step_method").bind("click", function(){
            var select = $("#step_method").val();
            
            $.ajax ({
                url: '/pipes/app/testMethod/queryList',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        if(list[i].name == select){
                            $("#explain").html(list[i].description);
                        }
                    }
                }
            });
        });
        
        //初始化 修改 测试步骤
        $('#update_step').bind("click", function () {
            var data_android = intervaljobtable_android.api(true).row({selected: true}).data();
            var data_ios = intervaljobtable_ios.api(true).row({selected: true}).data();
            
            $("#step_method").empty();
            $("#step_method").append("<option value=\'\'>请选择</option>");
            $.ajax ({
                url: '/pipes/app/testMethod/queryList',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        $("#step_method").append("<option value=\'" + list[i].name + "\'>" + list[i].name + "</option>");
                    }
                }
            });
            
            if (!data_android && !data_ios) {
                toastr.options.positionClass = 'toast-top-center';
                toastr.options.timeOut = 2000;
                toastr.warning("请先选择记录");
                return;
            }
            
            if (data_android && data_ios) {
                toastr.options.positionClass = 'toast-top-center';
                toastr.options.timeOut = 2000;
                toastr.warning("多选了哟");
                return;
            }
            
            if(!data_android){
                data_ios.step_type = "ios";
                $('#dtitle-test-step').html("新增");
                $("#form-test-step").form('reset');
                $("#form-test-step").form('load', data_ios);
                $('#dialog-test-step').modal('show');
            }
            
            if(!data_ios){
                data_android.step_type= "android";
                $('#dtitle-test-step').html("新增");
                $("#form-test-step").form('reset');
                $("#form-test-step").form('load', data_android);
                $('#dialog-test-step').modal('show');
            }
        });
        
        //新增&修改  测试步骤        
        $('#form-test-commit').bind("click", function (e) {
            var form = $("#form-test-step");
            var json = form.serializeJson();
            json["case_id"] = test_case_id_select;
            
            $.ajax({
                cache: false,
                dataType: "json",
                type: "POST",
                url: json.id ? '/pipes/app/casestep/update' : '/pipes/app/casestep/create',
                data: {
                    "bean": $.objectToString(json)
                },
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    if (data.retcode === 0) {
                        $("#dialog-test-step").modal('hide');
                        intervaljobtable_android.api(true).draw(false);
                        intervaljobtable_ios.api(true).draw(false);
                    } else {
                        toastr.options.positionClass = 'toast-top-center';
                        toastr.options.timeOut = 2000;
                        toastr.warning(data.retinfo);
                    }
                }
            });
        });
        
        // 复制用例
        $("#copy_test_case").bind("click", function(){
            $("#test_case_now").empty();
            $.ajax ({
                url: '/pipes/app/testcase/queryList',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        $("#test_case_now").append("<option value=\'" + list[i].id + "\'>" + list[i].ename + "</option>");
                    }
                }
            });
            
            $("#form-copy_test_case_dialog").form('reset');
            $("#copy_test_case_dialog").modal('show');
        });
        
        // 点击提交复制按钮
        $("#form-commit_copy").bind("click", function(){
            var test_platform = $("#copy_platform_id").val();
            var test_case_id = $("#test_case_now").val();
            var data_list = [];
            
            $.ajax ({
                url: '/pipes/app/casestep/queryList',
                async: false,
                cache: false,
                method: 'post',
                dataType: 'json',
                error: function () {
                    alert('请求失败');
                },
                success: function (data) {
                    var list = data.rows;
                    for(var i=0;i<list.length;i++){
                        if(list[i].case_id == test_case_id && list[i].step_type == test_platform){
                            data_list.push([list[i].step_run_id,list[i].step_method, list[i].parameter_1,list[i].parameter_2]);
                        }
                    }
                }
            });
            
            for(var i=0;i<data_list.length;i++){
                var json = {
                    "case_id": test_case_id_select,
                    "step_type": test_platform,
                    "step_run_id": data_list[i][0],
                    "step_method": data_list[i][1],
                    "parameter_1": data_list[i][2],
                    "parameter_2":  data_list[i][3]
                };
                $.ajax({
                    cache: false,
                    dataType: "json",
                    type: "POST",
                    url: '/pipes/app/casestep/create',
                    data: {
                        "bean": $.objectToString(json)
                    },
                    error: function () {
                        alert('请求失败');
                    },
                    success: function (data) {
                        if (data.retcode === 0) {
                            $("#copy_test_case_dialog").modal("hide");
                            intervaljobtable_android.api(true).draw(false);
                            intervaljobtable_ios.api(true).draw(false);
                        } else {
                            toastr.options.positionClass = 'toast-top-center';
                            toastr.options.timeOut = 2000;
                            toastr.warning(data.retinfo);
                        }
                    }
                });
            }
        });
    });
</script>
